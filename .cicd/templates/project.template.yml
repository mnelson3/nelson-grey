# Project Manifest Template
# Copy this file to .cicd/projects/<project-name>.yml and customize

project:
  name: "PROJECT_NAME"
  description: "Project description"
  owner: "nelsongrey"

targets:
  ios:
    enabled: true
    schemes:
      - name: "Main App"
        path: "packages/mobile/ios"
        configuration: "Release"
    signing:
      team_id: "${APPLE_TEAM_ID}"
      bundle_id: "com.example.app"
      profiles:
        development: true
        distribution: true
    destinations:
      testflight:
        enabled: true
        group: "Internal Testers"
      appstore:
        enabled: true

  android:
    enabled: true
    path: "packages/mobile/android"
    signing:
      keystore_ref: "${ANDROID_KEYSTORE_PATH}"
      key_alias: "${ANDROID_KEY_ALIAS}"
    destinations:
      firebase_app_distribution:
        enabled: true
        groups:
          - testers
      google_play:
        enabled: true
        track: "internal"

  web:
    enabled: false
    build_command: "npm run build"
    destinations:
      firebase_hosting:
        enabled: false
      github_pages:
        enabled: false

  docker:
    enabled: false
    services:
      - name: "api"
        dockerfile: "Dockerfile.api"
        registry: "docker.io"
        image_name: "myorg/myapi"

  firebase:
    enabled: true
    project_id: "project-name-prod"
    hosting:
      enabled: false
    functions:
      enabled: false
      paths:
        - "functions"
    firestore:
      deploy_rules: true
      deploy_indexes: true

ci:
  runners:
    macos:
      labels:
        - self-hosted
        - macOS
        - ios
      required: true
    docker:
      labels:
        - self-hosted
        - docker
      required: false

  triggers:
    - event: push
      branches:
        - develop
      paths:
        - "packages/mobile/**"
        - ".github/workflows/**"
        - "pubspec.yaml"

    - event: pull_request
      branches:
        - develop
        - staging
        - main
      paths:
        - "packages/mobile/**"
        - "packages/web/**"
        - ".github/workflows/**"

    - event: workflow_dispatch

  environment:
    development:
      firebase_config: "firebase.dev.json"
      secrets_profile: "dev"
    staging:
      firebase_config: "firebase.staging.json"
      secrets_profile: "staging"
    production:
      firebase_config: "firebase.prod.json"
      secrets_profile: "prod"

notifications:
  slack_webhook: "${SLACK_WEBHOOK_URL}"
  failure_recipients:
    - "devteam@example.com"
